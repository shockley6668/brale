# Shared defaults moved out of config.toml

[app]
env = "dev"
log_level = "info"
http_addr = ":9991"

[kline]
max_cached = 300

[market]
active_source = "binance"

[[market.sources]]
name = "binance"
enabled = true
rest_base_url = "https://fapi.binance.com"
ws_base_url = "wss://fstream.binance.com/stream"
rate_limit_per_min = 1200
ws_batch_size = 150

[ai]
aggregation = "meta"
decision_log_path = "/data/live/decisions.db"
last_decision_max_age_seconds = 3600
weights = { openai = 1.0, deepseek = 1.0, qwen = 1.0, vanchin = 1.0 }
log_each_model = true
# include_last_decision：是否把上一轮决策作为上下文。
include_last_decision = true

[symbols]
# provider：币种列表来源 default|http。
provider = "default"

[ai.profile_defaults.indicators.ema]
# fast/mid/slow：默认 EMA 周期（单位：根）。
fast = 9
mid = 21
slow = 55
[ai.profile_defaults.indicators.rsi]
# period/oversold/overbought：默认 RSI 参数。
period = 14
oversold = 33
overbought = 68

[ai.multi_agent]
# enabled：是否启用指标→形态→趋势多阶段 Agent。
enabled = true
# *_template：引用 prompts 目录下的模板名（不含 .txt）。
indicator_template = "agent_indicator"
pattern_template = "agent_pattern"
trend_template = "agent_trend"
# max_blocks：单次拆分的 symbol×interval 最大组合数。
max_blocks = 4



[ai.holding_horizon_profiles.one_hour]
# 1 小时持仓：短周期入场+中周期确认+4h 背景。
entry_timeframes = ["5m", "15m"]
confirm_timeframes = ["1h"]
background_timeframes = ["4h"]
slice_drop_tail = 1
[ai.holding_horizon_profiles.one_hour.indicators.rsi]
# QuantAgent 特有的 RSI 阈值。
oversold = 30
overbought = 70

[ai.holding_horizon_profiles.four_hour]
# 4 小时持仓：15/30m 入场，4h 确认，1d 背景。
entry_timeframes = ["15m", "30m"]
confirm_timeframes = ["4h"]
background_timeframes = ["1d"]
[ai.holding_horizon_profiles.four_hour.indicators.rsi]
# 4h 策略更保守的 RSI 阈值。
oversold = 30
overbought = 70

[ai.holding_horizon_profiles.one_day]
# 日线策略：1h 入场，4h/1d 确认，1w 背景。
entry_timeframes = ["1h"]
confirm_timeframes = ["4h", "1d"]
background_timeframes = ["1w"]
[ai.holding_horizon_profiles.one_day.indicators.rsi]
# 日线策略的 RSI 阈值。
oversold = 35
overbought = 65

[ai.holding_horizon_profiles.quant_agent]
# QuantAgent 组合：1h 入场，4h/1d 确认，1w 背景。
entry_timeframes = ["1h"]
confirm_timeframes = ["4h", "1d"]
background_timeframes = ["1w"]
# analysis_slice 留空继承默认 46，单独覆盖 drop tail。
# 注意：实际截取长度会自动不低于指标所需的最大 lookback（例如 slow EMA=200），
# 如需缩短窗口，需同步降低指标周期。
slice_drop_tail = 1
[ai.holding_horizon_profiles.quant_agent.indicators.rsi]
# QuantAgent 特有的 RSI 阈值。
oversold = 35
overbought = 65

[mcp]
# timeout_seconds：单次模型推理的超时时间（秒）。
timeout_seconds = 120
[prompt]
# dir：提示词模板目录（通常保持 prompts）。
dir = "prompts"
# system_template：默认系统提示模板名（不含 .txt）。
system_template = "prompt_default"

[advanced]
# liquidity_filter_usd_m：按 OI×价格估算的最低流动性（百万 USD）。
liquidity_filter_usd_m = 15
# min_risk_reward：接受的最低风险回报比。
min_risk_reward = 1
# open_cooldown_seconds：同 symbol+方向开仓的冷却时间（秒）。
open_cooldown_seconds = 180
# max_opens_per_cycle：单次决策循环内允许的新开仓数量。
max_opens_per_cycle = 3
# tier_min_distance_pct：若 Tier1 距离入场价过近（按该比例）则强制与止盈价对齐。
tier_min_distance_pct = 0.005

[trading]
# mode：资金模式（目前仅支持 static）。
mode = "static"
# static_balance：静态账户余额（USDT），用于推导默认仓位。
static_balance = 10000
# max_position_pct：单笔最大仓位占比 (0,1]。
max_position_pct = 0.01
# default_position_usd：若 >0 则固定仓位金额，否则按余额×占比。
default_position_usd = 0
# default_leverage：模型未提供 leverage 时的兜底倍数。
default_leverage = 10
